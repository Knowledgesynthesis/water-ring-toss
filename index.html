<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cannon.js Test</title>
<style>
  * { margin: 0; padding: 0; }
  body { overflow: hidden; background: #000; }
  #log {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-family: monospace;
    background: rgba(0,0,0,0.8);
    padding: 10px;
    z-index: 100;
    font-size: 14px;
    max-width: 500px;
  }
</style>
</head>
<body>
  <div id="log">Initializing...</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js"></script>

  <script>
    const log = document.getElementById('log');
    let logText = '';

    function addLog(msg) {
      logText += msg + '<br>';
      log.innerHTML = logText;
      console.log(msg);
    }

    try {
      addLog('✓ Starting...');

      // Check if libraries loaded
      addLog('THREE defined: ' + (typeof THREE !== 'undefined'));
      addLog('CANNON defined: ' + (typeof CANNON !== 'undefined'));

      if (typeof THREE === 'undefined') throw new Error('Three.js failed to load');
      if (typeof CANNON === 'undefined') throw new Error('Cannon.js failed to load');

      // Three.js setup
      addLog('✓ Creating scene...');
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x1a1a2e);

      addLog('✓ Creating camera...');
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 2, 5);
      camera.lookAt(0, 0, 0);

      addLog('✓ Creating renderer...');
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      addLog('✓ Adding lights...');
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
      dirLight.position.set(5, 10, 5);
      scene.add(dirLight);

      // Cannon.js setup
      addLog('✓ Creating Cannon world...');
      const world = new CANNON.World();
      world.gravity.set(0, -9.82, 0);
      addLog('✓ Gravity set: ' + world.gravity.y);

      // Ground
      addLog('✓ Creating ground...');
      const groundShape = new CANNON.Plane();
      const groundBody = new CANNON.Body({ mass: 0 });
      groundBody.addShape(groundShape);
      groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
      world.addBody(groundBody);
      addLog('✓ Ground added to world');

      // Visual ground
      const groundGeo = new THREE.PlaneGeometry(10, 10);
      const groundMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
      const groundMesh = new THREE.Mesh(groundGeo, groundMat);
      groundMesh.rotation.x = -Math.PI / 2;
      scene.add(groundMesh);

      // Falling sphere
      addLog('✓ Creating sphere...');
      const sphereShape = new CANNON.Sphere(0.5);
      const sphereBody = new CANNON.Body({ mass: 1 });
      sphereBody.addShape(sphereShape);
      sphereBody.position.set(0, 3, 0);
      world.addBody(sphereBody);
      addLog('✓ Sphere added at y=' + sphereBody.position.y);

      // Visual sphere
      const sphereGeo = new THREE.SphereGeometry(0.5, 32, 32);
      const sphereMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
      const sphereMesh = new THREE.Mesh(sphereGeo, sphereMat);
      sphereMesh.position.set(0, 3, 0);
      scene.add(sphereMesh);

      addLog('✓ Starting animation...');

      let frameCount = 0;

      function animate() {
        requestAnimationFrame(animate);

        frameCount++;

        // Step physics
        world.step(1 / 60);

        // Sync visual with physics
        sphereMesh.position.set(
          sphereBody.position.x,
          sphereBody.position.y,
          sphereBody.position.z
        );

        // Update log every 60 frames
        if (frameCount % 60 === 0) {
          addLog('Frame ' + frameCount + ' | Sphere Y: ' + sphereBody.position.y.toFixed(2));
        }

        renderer.render(scene, camera);
      }

      animate();

      addLog('<span style="color:#0f0">✓✓✓ ALL WORKING! Watch the red sphere fall!</span>');

    } catch (error) {
      addLog('<span style="color:#f00">❌ ERROR: ' + error.message + '</span>');
      console.error('Full error:', error);
    }
  </script>
</body>
</html>
